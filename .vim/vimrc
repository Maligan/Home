set nocompatible

if has("multi_byte")
	set encoding=utf-8
	if &termencoding == ""
		let &termencoding = &encoding
	endif
	setglobal fileencoding=utf-8
	set fileencodings=ucs-bom,utf-8,latin1
endif

" Pathogen
call pathogen#infect('~/.vim/bundle/snipmate')
call pathogen#infect()
filetype plugin indent on

" Behaviors
set title
set shortmess+=I
set hidden
set noswapfile
set backspace=indent,eol,start
set mouse=a
set scrolloff=0
set nowrap
set autowrite
set autoread
set linebreak
set ignorecase
set smartcase
set listchars=tab:▸\ ,eol:¬,trail:·
set fillchars=vert:│
set wmh=0
set clipboard=unnamed
set shell=/bin/bash
let NERDTreeMinimalUI=1

" Hotkeys
inoremap kj <Esc>
noremap <C-c> <Esc>
let mapleader=","
nnoremap ; :
vnoremap ; :

nmap <silent> <leader>rc :e $MYVIMRC<CR>
nmap <silent> <leader>/ :set hlsearch!<CR>
nmap <silent> <leader>w :set list!<CR>
nmap <silent> <leader>t :NERDTreeToggle<CR>
nmap <silent> <leader>n :NERDTreeFind<CR>
nmap <silent> <leader>m :make %<CR>
nmap <silent> <leader>cp :CPPaste<CR>
" Run current script
nnoremap <Leader>s :%s/\<<C-r><C-w>\>//g<Left><Left>
inoremap <C-L> <C-^>
"map <leader>s :execute "lvimgrep /" . expand("<cword>") . "/j **" <Bar> lopen<CR>

" Autocompete
let g:SuperTabMappingBackward = '<c-@>'
let g:SuperTabMappingForward = ''
set completeopt=menuone

"
" CamelComplete
"
function! TagCamelCompleteFunction(findstart, base)
    if a:findstart
        let line = getline('.')
        let start = col('.') - 1
        while start > 0 && line[start - 1] =~ '[A-Za-z_]'
            let start -= 1
        endwhile
        return start
    else
		" Define camel-pattren
		let pattern = '\v\C^' . join(split(a:base, '\u\&'), '[A-Za-z_\d]*')

		" Fetch 'name' field from tags
		let matches = []
		for entry in taglist(pattern) 
			call add(matches, entry['name'])
		endfor

		return matches
    endif
endfunction

set omnifunc=TagCamelCompleteFunction

autocmd BufWritePost *
	\ if filereadable('tags') |
	\   call system('ctags -a '.expand('%')) |
	\ endif

autocmd FileType *
    \ if &omnifunc != '' |
    \   call SuperTabChain(&omnifunc, "<c-p>") |
    \   call SuperTabSetDefaultCompletionType("<c-x><c-u>") |
    \ endif

"autocmd FileType xml exe ":silent 1,$!xmllint --format --recover - 2>/dev/null"

" Indent
set tabstop=4
set shiftwidth=4
set softtabstop=4
set autoindent
set smartindent

" Statusbar
set laststatus=1
set showmode
set showcmd
set noruler

" Colors
let g:solarized_termtrans=1
let g:solarized_style="dark"
set background=dark
colorscheme solarized

" TRASH
set incsearch
syntax on
set nowrap
set number
set numberwidth=4

" Auto source .vimrc
if has("autocmd")
	autocmd! BufWritePost .vimrc 
	autocmd BufWritePost .vimrc source $MYVIMRC
endif


if &term =~ '^xterm'
	" remove defalult identificatoin
	set noshowmode
	" solid underscore
	let &t_SI .= "\<Esc>[5 q"
	" solid block
	let &t_EI .= "\<Esc>[1 q"
endif

"
" ActionScriptCompiler
"
compiler mxmlc
nmap <S-F6> :make clean<CR>
nmap <F6> :make -s<CR>
nmap <F5> :!adl descriptor.xml -screensize iPhone<CR>
nmap <S-F5> :make -s<CR><F5>
nmap <leader>r :!open %:r.swf<cr>:!tail -f "C:\Users\Maligan\AppData\Roaming\Macromedia\Flash Player\Logs\flashlog.txt"<cr>
set wildignore=*.swc,*.swf,ctags,*.apk

nmap <F1> :echo map(synstack(line('.'), col('.')), 'synIDattr(v:val, "name")')<CR>

"
" Lang settings
"
set keymap=russian-jcukenwin
set iminsert=0
set imsearch=0

nnoremap <s-k> :silent execute ':!cygstart http://www.google.com/?hl=ru\&q='.expand("<cword>").'\&btnI=Search'<CR>

